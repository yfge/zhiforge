# 发布知乎文章

## 输入
$ARGUMENTS - 知乎问题标题、链接或关键词（可选）

## 任务
通过知乎专栏写作页面发布文章，绕过40362反爬虫限制。

---

## 完整流程

### 第一步：准备内容

1. 读取 `claude.md` 了解作者专业领域和写作风格
2. 如果有指定问题，搜索博客目录 `/Users/geyunfei/dev/yfge/yfge.github.com/_posts/` 找到相关文章
3. 根据博客内容草拟文章（标准markdown格式）
4. **将文章写入临时文件**（关键！）
   ```
   /private/tmp/claude-501/.../scratchpad/zhihu-article.md
   ```

### 第二步：打开专栏写作页面

**必须使用这个URL：**
```
https://zhuanlan.zhihu.com/write
```

**坑1: 40362反爬虫**
- 直接访问问题页面 `/question/xxx` 会触发40362错误
- 从首页导航、搜索结果点击都会触发
- 唯一稳定的入口是专栏写作页面

### 第三步：导入Markdown文件

**坑2: 不能直接fill内容**
- 直接fill到编辑器，markdown语法会显示为纯文本
- 必须使用"导入"功能

**正确操作：**
1. 点击工具栏的"导入"按钮
2. 出现下拉菜单，点击"导入文档"
3. 出现对话框，点击"点击选择本地文档或拖动文件到窗口上传"
4. 使用 `upload_file` 上传markdown文件
5. 等待"文档导入中，请稍等..."消失

**坑3: 导入是追加不是替换**
- 如果编辑器已有内容，导入会追加而不是替换
- 解决：先导航到 `zhuanlan.zhihu.com/write` 打开全新空白页面

### 第四步：填写标题

导入成功后，标题栏可能为空或只有文件名。

```
fill标题框: "你的文章标题"
```

**坑4: 标题可能被污染**
- 某些操作可能在标题末尾追加多余文字
- 解决：导入完成后，用fill重新设置正确标题

### 第五步：设置投稿至问题

1. 滚动到右侧"发布设置"区域
2. 找到"投稿至问题"，点击下拉框（combobox）
3. 出现对话框，显示推荐问题列表
4. 如果目标问题在列表中，直接点击"选择"按钮
5. 如果不在，使用搜索框搜索
6. 选择后显示"已选择"
7. 点击"确定"按钮

**坑5: 对话框难关闭**
- 点击"确定"或"关闭"按钮有时超时
- 解决：使用 `press_key("Escape")` 关闭

**坑6: 搜索框是combobox**
- 不能直接fill combobox
- 解决：先click搜索框聚焦，再fill或press_key输入

### 第六步：添加话题（可选）

1. 点击"添加话题"按钮
2. 出现搜索框，输入话题关键词
3. 点击搜索按钮
4. 从结果中选择话题

**坑7: 话题按钮点击可能超时**
- 解决：可以跳过话题，不影响发布

### 第七步：发布

1. 点击"发布"按钮
2. 按钮变成"发布中..." (disabled)
3. 等待发布完成

**坑8: 发布后可能触发40362**
- 发布成功后自动跳转到文章页面
- 文章页面可能触发40362反爬虫
- 但URL显示 `?just_published=1` 说明已发布成功

### 第八步：确认发布状态

**不要信任文章页面，去创作中心确认：**
```
https://www.zhihu.com/creator/manage/creation/article
```

查看文章列表，确认：
- 文章标题正确
- 显示"发布于刚刚"
- 有阅读数（哪怕是1）

---

## 关键代码片段

### 写入临时markdown文件
```python
Write(
  file_path="/private/tmp/.../scratchpad/zhihu-article.md",
  content="# 标题\n\n正文内容..."
)
```

### 上传文件到导入对话框
```python
# 点击导入按钮
click(uid="导入按钮的uid")
# 点击导入文档
click(uid="导入文档按钮的uid")
# 上传文件
upload_file(
  uid="点击选择本地文档按钮的uid",
  filePath="/private/tmp/.../scratchpad/zhihu-article.md"
)
```

### 等待导入完成
```python
wait_for(text="vibe-coding", timeout=15000)  # 等待内容出现
```

### 关闭顽固对话框
```python
press_key(key="Escape")
```

---

## 写作风格

- 开门见山，先给结论
- 用实际案例说话（引用博客中的项目经验）
- 技术内容要落地可执行
- 代码块使用 ```bash 或 ```python 标注语言
- 列表使用 - 或 1. 2. 3.
- 重点用 **加粗** 或 `代码格式`
- 结尾引导关注公众号「IT老拐瘦」或博客 yfge.github.io

---

## 常见问题排查

| 问题 | 原因 | 解决方案 |
|------|------|----------|
| 40362错误 | 访问了问题页面 | 只用 zhuanlan.zhihu.com/write |
| Markdown不解析 | 直接fill内容 | 使用"导入文档"功能 |
| 内容被追加 | 编辑器已有内容 | 打开新的write页面 |
| 标题多余文字 | fill操作污染 | 重新fill正确标题 |
| 对话框关不掉 | 按钮超时 | 用ESC键关闭 |
| 话题添加失败 | 按钮超时 | 跳过，不影响发布 |
| 发布后报错 | 文章页触发反爬 | 去创作中心确认 |

---

## 注意事项

- 保持"老拐"的风格：务实、不油腻、有干货
- 如果问题与专业领域不匹配，诚实告知并建议跳过
- 专栏文章发布后会自动关联到所选问题
- 草稿会自动保存，如果中途失败可以从草稿箱恢复

---

## 示例

```bash
# 根据问题关键词发布
/publish-zhihu Claude Code 工作流程

# 根据问题链接发布
/publish-zhihu https://www.zhihu.com/question/1996665109376962786

# 发布通用文章（不关联问题）
/publish-zhihu
```
